- name: Inject Firebase config into FirebaseData.js
  run: |
    echo "Writing new config block..."
    cat > new_config.js <<EOF
const firebaseConfig = {
  apiKey: '${{ secrets.API }}',
  authDomain: '${{ secrets.AUTH_DOMAIN }}',
  databaseURL: '${{ secrets.URL }}',
  projectId: '${{ secrets.PRJ_ID }}',
  storageBucket: '${{ secrets.BUCKET }}',
  messagingSenderId: '${{ secrets.MSG_ID }}',
  appId: '${{ secrets.ID }}'
};
EOF

    echo "Replacing config block in FirebaseData.js..."

    awk '
      BEGIN {inside=0}
      /^\s*const firebaseConfig\s*=\s*{\s*$/ {    # match even if spaces vary
        system("cat new_config.js");
        inside=1;
        next
      }
      /^\s*};\s*$/ && inside {
        inside=0;
        next
      }
      !inside {print}
    ' FirebaseData.js > FirebaseData.tmp && mv FirebaseData.tmp FirebaseData.js

    echo "New FirebaseData.js contents:"
    cat FirebaseData.js
